<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Portfolio</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="dashboard-page">
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active"><i class="fas fa-home"></i> Overview</a></li>
                <li><a href="#messages"><i class="fas fa-envelope"></i> Messages</a></li>
                <li><a href="#projects"><i class="fas fa-briefcase"></i> Projects</a></li>
                <li><a href="index.html" target="_blank"><i class="fas fa-external-link-alt"></i> View Portfolio</a>
                </li>
                <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Portfolio Admin</h1>
                <div class="user-info">
                    <div class="user-avatar">KJ</div>
                    <span>Admin</span>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(67, 97, 238, 0.1); color: #4361ee;">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-messages">0</h3>
                        <p>Total Messages</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(76, 201, 240, 0.1); color: #4cc9f0;">
                        <i class="fas fa-envelope-open"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="read-messages">0</h3>
                        <p>Read Messages</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(248, 150, 30, 0.1); color: #f8961e;">
                        <i class="fas fa-code"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-projects">0</h3>
                        <p>Total Projects</p>
                    </div>
                </div>
            </div>

            <!-- Messages Table -->
            <div class="table-container">
                <div class="table-header">
                    <h2>Contact Messages</h2>
                    <div class="table-actions">
                        <button class="btn btn-primary" id="refresh-btn">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Subject</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messages-table">
                            <!-- Messages loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div class="modal" id="messageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Message Details</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message-details">
                    <div class="detail-group">
                        <div class="detail-label">Name</div>
                        <div class="detail-value" id="modal-name">-</div>
                    </div>
                    <div class="detail-group">
                        <div class="detail-label">Email</div>
                        <div class="detail-value" id="modal-email">-</div>
                    </div>
                    <div class="detail-group">
                        <div class="detail-label">Subject</div>
                        <div class="detail-value" id="modal-subject">-</div>
                    </div>
                    <div class="detail-group">
                        <div class="detail-label">Date</div>
                        <div class="detail-value" id="modal-date">-</div>
                    </div>
                    <div class="detail-group message-content">
                        <div class="detail-label">Message</div>
                        <div class="message-text" id="modal-message">-</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="reply-btn">
                    <i class="fas fa-reply"></i> Reply
                </button>
                <button class="btn btn-outline" id="mark-read-btn">
                    <i class="fas fa-check"></i> Mark as Read
                </button>
            </div>
        </div>
    </div>

    <script>
        // Admin Dashboard JavaScript
        let currentMessageId = null;

        // Check authentication
        if (!localStorage.getItem('adminToken')) {
            window.location.href = 'admin-login.html';
        }

        // Load data
        async function loadDashboardData() {
            try {
                const response = await fetch('/.netlify/functions/get-messages');
                const messages = await response.json();

                updateStats(messages);
                renderMessagesTable(messages);
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function updateStats(messages) {
            document.getElementById('total-messages').textContent = messages.length;
            document.getElementById('read-messages').textContent =
                messages.filter(m => m.status === 'read').length;
        }

        function renderMessagesTable(messages) {
            const table = document.getElementById('messages-table');
            table.innerHTML = messages.map(message => `
                <tr>
                    <td>
                        <div class="contact-name">
                            <div class="contact-avatar">${message.name.charAt(0)}</div>
                            <span>${message.name}</span>
                        </div>
                    </td>
                    <td>${message.email}</td>
                    <td>${message.subject}</td>
                    <td>${new Date(message.created_at).toLocaleDateString()}</td>
                    <td><span class="status status-${message.status}">${message.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view-btn" data-id="${message.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn delete-btn" data-id="${message.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Add event listeners
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => viewMessage(btn.dataset.id));
            });
        }

        function viewMessage(messageId) {
            // Implement view message functionality
            currentMessageId = messageId;
            document.getElementById('messageModal').style.display = 'flex';
        }

        // Event Listeners
        document.getElementById('refresh-btn').addEventListener('click', loadDashboardData);
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('adminToken');
            window.location.href = 'admin-login.html';
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', loadDashboardData);
    </script>
</body>

</html>